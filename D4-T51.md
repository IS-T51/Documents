---
pdf_options:
    format: a4
    margin: 30mm 20mm
    printBackground: true
    headerTemplate: |-
        <style>
            section {
                margin: 0 auto;
                font-family: system-ui;
                font-size: 11px;
            }
        </style>
        <section>
            D4 - Animati - Sviluppo v0.1 [pre-release]
        </section>
    footerTemplate: |-
        <section>
            <div>
                Pagina <span class="pageNumber"></span>
                di <span class="totalPages"></span>
            </div>
        </section>
---
<img alt="Università degli Studi di Trento" src="https://www.agenziagiornalisticaopinione.it/wp-content/uploads/2019/09/Logo-UniTrento-2019.jpg" width="45%" /> Dipartimento di Ingegneria e Scienza dell’Informazione

---

### Progetto:
<h1 align="center">Animati</h1>

<center><img alt="Logo" src="https://github.com/IS-T51/animati/blob/main/assets/img/logo.svg?raw=true" width="75%" /></center>

### Titolo del documento:
<h1 align="center">Sviluppo</h1>

### Gruppo:
<h1 align="center">T51</h1>

<div class="page-break"></div>

# Indice
<span class=horizontal_dotted_line>1. User Flows<span class=dot></span>3</span>
<span class=horizontal_dotted_line>2. Application Implementation and Documentation<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.1. Project Structure<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.2. Project Dependencies<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.3. Project Data or DB<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.4. Project APIs<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.4.1. Resources Extraction from the Class Diagram<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.4.2. Resources Models<span class=dot></span>?</span>
<span class=horizontal_dotted_line>2.5. Sviluppo API<span class=dot></span>?</span>
<span class=horizontal_dotted_line>3. API documentation<span class=dot></span>?</span>
<span class=horizontal_dotted_line>4. FrontEnd Implementation<span class=dot></span>?</span>
<span class=horizontal_dotted_line>5. GitHub Repository and Deployment Info<span class=dot></span>?</span>
<span class=horizontal_dotted_line>6. Testing<span class=dot></span>?</span>

<style>
.horizontal_dotted_line{
    width: 100%;
    display : flex;
}
.dot{
    flex: 1;
    border-bottom: 2px dotted black;
    margin-left: 5px;
    margin-right: 5px;
    height: 1em;
}
</style>
<div class="page-break"></div>

# Scopo del documento
Il presente documento fornisce tutte le informazioni necessarie per lo sviluppo di una parte dell'applicazione Animati. In particolare, presenta tutti gli artefatti necessari per realizzare i servizi di Animati. Partendo dalla descrizione degli user flow legati ai tre ruoli presenti nell'applicazione, il documento prosegue con la presentazione delle API necessarie (tramite l'API Model e il Modello delle risorse) per poter visualizzare, inserire e modificare attività del catalogo di Animati; manipolare le liste, le valutazioni e le segnalazioni. Per le API realizzate, oltre ad una descrizione delle funzionalità fornite, il documento presenta la sua documentazione e i test effettuati.
Infine, una sezione è dedicata alle informazioni del Git Repository e al deployment dell'applicazione stessa.

<div class="page-break"></div>

# User Flows
In questa sezione del documento di sviluppo riportiamo gli "user flows" per i tre diversi ruoli: anonimo, autenticato e amministratore, nonché quelli degli strumenti.

## Utente Anonimo
La figura sottostante descrive lo user flow relativo alle azioni che un utente anonimo, ovvero senza autenticazione, riesce ad eseguire.
L'utente inizialmente, dal menù, può consultare il catalogo e la lista degli strumenti e può effettuare l'accesso con Google.
- A partire dal catalogo l'utente può applicare dei filtri, facendo in modo di consultare un sottoinsieme del catalogo completo con le caratteristiche desiderate. Oltre a ciò l'utente, sia prima che dopo aver eventualmente applicato dei filtri, può consultare le attività del catalogo.
- A partire dalla lista degli strumenti, l'utente può selezionare uno strumento presente.

<img src="img/uf/anonimo.png" width=1070px>

## Utente Autenticato
La figura sottostante descrive lo user flow relativo alle azioni che un utente autenticato, ovvero che ha effettuato l'accesso con il suo account Google, riesce ad eseguire.
L'utente inizialmente, dal menù, può consultare il catalogo e la lista degli strumenti, andare sul proprio profilo utente, consultare la lista di liste di attività e i preferiti e proporre nuove attività.
- A partire dal catalogo, l'utente autenticato può eseguire le stesse operazioni che può eseguire un utente anonimo, ovvero applicare dei filtri e cliccare sulle attività per consultarle.
- A partire da un'attività, l'utente autenticato può cliccare sui collegamenti (se esistono), aggiungere l'attività ai preferiti o ad una lista, aggiungere una valutazione, creare una segnalazione e, se l'utente è autore dell'attività stessa, modificarla.
- A partire da Segnala, Modifica e Proponi attività, l'utente autenticato può confermare l'azione oppure annullarla, tornando al menù.
- A partire da Preferiti e da Liste di attività (dopo aver selezionato una lista), l'utente autenticato va sulla lista stessa e da li può cliccare su un'attività, esportare la lista, se la lista non è quella dei preferiti, eliminarla, ed eliminare un'attività dalla lista.
- Da Liste di attività, un utente autenticato può anche creare una nuova lista, dovendo poi confermare (andando alla lista di attività) o annullare (tornando a liste di attività).
- A partire dalla lista degli strumenti, l'utente autenticato può eseguire le stesse azioni di un utente anonimo, ovvero selezionare uno strumento presente.

<img src="img/uf/autenticato.png" width=1070px>

## Utente Amministratore
La figura sottostante descrive lo user flow relativo alle azioni che un utente amministratore, ovvero un'utente autenticato con privilegi speciali di coordinamento dell'applicazione, riesce ad eseguire. L'utente inizialmente, dal menù, può consultare il catalogo e la lista degli strumenti, andare sul proprio profilo utente, consultare la lista di liste di attività e i preferiti, proporre nuove attività, consultare l'elenco delle segnalazioni e entrare in gestione utenti.
- A partire dal catalogo, l'utente amministratore può eseguire le stesse operazioni che può eseguire un utente anonimo, ovvero applicare dei filtri e cliccare sulle attività per consultarle.
- A partire da un'attività, l'utente amministratore può cliccare sui collegamenti (se esistono), aggiungere l'attività ai preferiti o ad una lista, aggiungere una valutazione, creare una segnalazione e modificare l'attività.
- A partire da Segnala, Modifica e Proponi attività, l'utente amministratore può confermare l'azione oppure annullarla, tornando al menù.
- A partire da Preferiti e da Liste di attività (dopo aver selezionato una lista), l'utente amministratore va sulla lista stessa e da li può cliccare su un'attività, esportare la lista, se la lista non è quella dei preferiti, eliminarla, ed eliminare un'attività dalla lista.
- Da Liste di attività, un utente amministratore può anche creare una nuova lista, dovendo poi confermare (andando alla lista di attività) o annullare (tornando a liste di attività).
- A partire dalla lista degli strumenti, l'utente amministratore può eseguire le stesse azioni di un utente anonimo, ovvero selezionare uno strumento presente.
- A partire dall'elenco delle segnalazioni, l'utente amministratore può cliccare su un'attività segnalata per vedere le segnalazioni dell'attività stessa.
- A partire da Gestione utenti, l'utente amministratore può promuovere qualsiasi utente e retrocedere gli utenti di cui è stato promotore.

<img src="img/uf/amministratore.png" width=1070px>

## Strumenti
### Timer
La figura sottostante descrive lo user flow dello strumento Timer, utilizzabile da tutti gli utenti.
- A partire da Timer, l'utente può premere Avvia, iniziando il conto alla rovescia, tornare indietro alla lista degli strumenti e scegliere un suono.
- A partire da Contando, l'utente può premere Pausa, fermando momentaneamente il timer, premenre Elimina, cancellando il timer e tornando all'inizio, oppure aspettare lo scadere dello stesso, seguito dalla riproduzione del suono scelto al punto precedente.
- A partire da Pausa, l'utente può premere Riprendi, continuando il conto alla rovescia precendentemente fermato, o Elimina, cancellando il timer e tornando all'inizio.
- A partire da Timer suona, l'utente deve premere Stop per poter fermare il suono in riproduzione al termine del timer. Una volta fatto ciò viene riportato all'inizio.

<img src="img/uf/timer.png" width=1070px>

### Cronometro
La figura sottostante descrive lo user flow dello strumento Cronometro, utilizzabile da tutti gli utenti.
- A partire da Cronometro, l'utente può premere Start, facendo partire il cronometro e tornare indietro alla lista degli strumenti.
- A partire da Contando, l'utente può premere Pausa, fermando temporaneamente il cronometro, o parziale, salvando il tempo di quell'istante in una lista visualizzata sotto il cronometro senza fermare il cronometro.
- A partire da Pausa, l'utente può premere Riprendi per riavviare il cronometro dall'istante in cui era stato fermato, oppure premere Stop, per tornare all'inizio.

<img src="img/uf/cronometro.png" width=1070px>

### Fischietto
La figura sottostante descrive lo user flow dello strumento Fischietto, utilizzabile da tutti gli utenti.
- A partire da Fischietto, l'utente può premere il pulsante per fischiare, tornare indietro alla lista degli strumenti e scegliere un suono.
- A partire da Scelta suono, l'utente può selezionare un suono oppure aggiungerne uno.
- A partire da Fischietto suona, l'utente deve tenere premuto per l'intera durata del fischio desiderato. Nel momento in cui il pulsante viene rilasciato il suono smette di essere riprodotto.

<img src="img/uf/fischietto.png" width=1070px>

### Segna-Punti
La figura sottostante descrive lo user flow dello strumento Segna-Punti, utilizzabile da tutti gli utenti.
- A partire da Segna Punti, l'utente può aggiungere un contatore, tornare indietro alla lista degli strumenti o procedere al contatore.
- A partire da Aggiungi contatore, l'utente può confermare o annullare l'azione.
- A partire da Contatori, l'utente può decrementare o incrementare i contatori esistenti.

<img src="img/uf/segnapunti.png" width=1070px>

### Dado
La figura sottostante descrive lo user flow dello strumento Dado, utilizzabile da tutti gli utenti.
- A partire da Dado, l'utente può scegliere la tipologia di faccia usata e tornare indietro.
- A partire da Dado Immagini, Dado Colori, Dado Parole e Dado Numeri, l'utente può iniziare l'estrazione fino a che non finisce.

<img src="img/uf/dado.png" width=1070px>

### Creazione Squadre
La figura sottostante descrive lo user flow dello strumento Creazione Squadre, utilizzabile da tutti gli utenti.
- A partire da Creazione squadre, l'utente può cambiare i parametri grazie a incrementa e decrementa contatore o può decidere di iniziare l'estrazione, che andrà avanti fino a che non finisce.

<img src="img/uf/squadre.png" width=1070px>

<div class="page-break"></div>

# Application Implementation and Documentation
[...]

<div class="page-break"></div>

# Application Implementation and Documentation
Nelle sezioni precedenti abbiamo identificato le varie features che devono essere implementate
per la nostra applicazione con uno schema precisa di come i nostri utenti finali possono utilizzarle nel
suo flusso applicativo. 

Il server è stato sviluppato utilizzando NodeJS e OAS3-Tools, il client è stato sviluppato utilizzando Bootstrap e JQuery, mentre per la gestione dei dati abbiamo fatto affidamento a MongoDB.

## Project Structure
### Server
La struttura del server è la seguente:
> **api/** - *cartella per la configurazione delle api*
>> **openapi.yaml** - *file di configurazione di OpenAPI per la generazione automatica delle route per le API**
>
> **controllers/** - *cartella conenente i controllori per le richieste in ingresso*
>> **\<componente\>.js** - *files responsabili per il collegamento fra route e services*
>
> **models/** - *cartella contenente la definizione dei modelli usati dalla libreria Mongoose per interfacciarsi con MongoDB*
>>  **\<modello\>.js**- *file contenente la definizione del modello*
>
> **schema/** - *cartella contenente la definizione delle strutture dati usate durante la definizione dei modelli*
>> **\<schema\>.js**- *file contenente la definizione della struttura del documento*
>
> **service/** - *cartella contenente l'implementazione della logica del server*
> **\<servizio\>.js** - *file con l'implementazione dei vari servizi offerti da Animati*
>
> **test/** - *cartella contenente i file di test*
>> **<test>.test.js** - *file responsabile del testing dei servizi offerti dal server Animati*
>
> **utils/** - *cartella contenente file d'utilità*
>> **database.js** - *file contenente funzioni di utilità per il collegamento ed inizializzazione del database*
>> **writer.js** - *file contenente funzioni di utilità per la scrittura delle risposte HTTP*
>
> **index.js** - *file principale del server, responsabile dell'inizializzazione e dell'orchestrazione delle varie componenti*
>
> **package.json** - *file di configurazione del progetto NodeJS*
>
> **vercel.json** - *file di configurazione di Vercel, responsabile del deployment*

### Client
La struttura del client è la seguente:
> **assets/** - *cartella contenente i file statici*
>> **bootstrap/** - *cartella contenente i file di Bootstrap*
>>> **css/** - *cartella contenente i file CSS di Bootstrap*
>>>> **bootstrap.min.css** - *file CSS di Bootstrap*
>>>
>>> **js/** - *cartella contenente i file JavaScript di Bootstrap*
>>>> **bootstrap.bundle.min.js** - *file JavaScript di Bootstrap*
>>
>> **css/** - *cartella contenente i file CSS dell'intero client*
>>>**style.css** - *file responsabile della definizione del tema del client*
>>>
>>> **markdown-editor.min.css** - *file CSS del Markdown Editor*
>>
>> **fonts/** - *cartella contenente i file dei font utilizzati nel progetto*
>>> **\<font\>** - *file del font*
>>
>> **html/** - *cartella contenente alcuni componenti HTML comuni all'intero client*
>>> **header.html** - *file conenente la definizione della barra di navigazione*
>>>
>>> **modulo.html** - *file contenente la definizione del modulo per la creazione, proposta o modifica di un'attività*
>>
>> **img/** - *cartella contenente le immagini utilizzate nel progetto*
>>> **logo.svg** - *l'immagine vettoriale del logo*
>>>
>>> **logo\<dim\>.png** - *l'immagine del logo in formato PNG*
>>
>> **js/** - *cartella contenente i file JavaScript dell'intero client*
>>> **jquery-3.6.1.min.js** - *file della libreria JQuery*
>>>
>>> **markdown-editor.min.js** - *file JavaScript del Markdown Editor*
>>>
>>> **markdown-it.min.js** - *file JavaScript del renderizzatore Markdown*
>>>
>>> **purify.min.js** - *file JavaScript per la pulizia del codice HTML*
>>>
>>> **script.js** - *file JavaScript contenente le funzioni di utilità per il client*
>
> **\<route\>/** - *cartella contenente i file relativi alla pagina di una specifica route*
>> **index.html** - *file contenente la definizione della pagina*
>>
>> **script.js** - *file JavaScript contenente la logica della pagina*
>>
>> **style.css** - *file CSS contenente la definizione del tema della pagina*
>
> **index.html** - *file contenente la definizione della pagina principale del client*
>
> **manifest.webmanifest** - *file contenente la definizione del manifest del client*
>
> **sw.js** - *file contenente la definizione del service worker del client*

## Project Dependencies
### Server
Le dipendenze del server sono le seguenti:
| Nome | Versione |
| --- | --- |
| connect | ^3.2.0 |
| cors | ^2.8.5 |
| dotenv | ^16.0.3 |
| google-auth-library | ^8.7.0 |
| googleapis | ^110.0.0 |
| js-yaml | ^3.3.0 |
| jsonwebtoken | ^9.0.0 |
| mongoose | ^6.8.2 |
| oas3-tools-cors | ^2.3.5 |

Tali moduli NodeJS sono stati utilizzati e aggiunti al file `package.json`.

### Client
Le dipendenze del client sono le seguenti:
| Nome | Versione |
| --- | --- |
| bootstrap | v5.3.0-alpha1 |
| jquery | v3.6.1 |
| markdown-it | v12.2.0 |
| krajee-markdown-editor | v1.0.1 |
| purify | v0.7.4 |
| fontawesome-free | v5.12.0 |

## Project Data
Per la gestione dei dati, Animati utilizza un database MongoDB. Tale database è stato creato su MongoDB Atlas, un servizio cloud offerto da MongoDB. Il database è stato creato tramite il servizio Atlas e contiene le seguenti collezioni:
| Nome | Descrizione |
| --- | --- |
| Catalogo | Contiene i dati delle attività |
| Etichette | Contiene le etichette delle attività |
| Liste | Contiene le liste di attività |
| Segnalazioni | Contiene le segnalazioni di attività |
| Utenti | Contiene i dati degli utenti registrati |
| Valutazioni | Contiene le valutazioni delle attività |

--- 
Per rappresentare i dati, Animati utilizza i seguenti schemi:
### `Attività`
```js
{
    banner: String,
    informazioni: InformazioniSchema,
    collegamenti: [CollegamentoSchema],
    ultimaModifica: {
        type: Date,
        default: Date.now
    },
    autore: {
        type: mongoose.Types.ObjectId,
        ref: 'Utenti',
        default: mongoose.Types.ObjectId('000000000000000000000000')
    },
    mediaValutazioni: Number,
    numeroSegnalazioni: Number
}
```

### `Collegamento`
```js
{
    nome: {
        type: String,
        required: true
    },
    link: {
        type: String,
        required: true
    }
}
```

### `Etichetta`
```js
{
    nome: {
        type: String,
        required: true
    },
    descrizione: {
        type: String,
        required: true
    },
    categoria: {
        type: String,
        required: true
    }
}
```

### `Informazioni`
```js
{
    titolo: String,
    descrizione: String,
    etàMin: Number,
    etàMax: Number,
    durataMin: Number,
    durataMax: Number,
    giocatoriMin: Number,
    giocatoriMax: Number,
    giocatoriPerSquadra: Number,
    giocatoriPerSquadraSet: Boolean,
    numeroSquadre: Number,
    numeroSquadreSet: Boolean,
    etichette: [EtichetteSchema]
}
```

### `Lista`
```js
{
    nome: {
        type: String,
        required: true
    },
    autore: {
        type: mongoose.Types.ObjectId,
        ref: 'Utenti',
        required: true
    },
    'attività': {
        type: [mongoose.Types.ObjectId],
        ref: 'Catalogo',
        default: []
    },
    ultimaModifica: {
        type: Date,
        default: Date.now
    }
}
```

### `Segnalazione`
```js
{
    messaggio: {
        type: String,
        required: true
    },
    titolo: {
        type: String,
        required: true
    },
    'attività': {
        type: mongoose.Types.ObjectId,
        ref: 'Catalogo',
        required: true
    },
    autore: {
        type: mongoose.Types.ObjectId,
        ref: 'Utenti',
        required: true
    }
}
```

### `Utenti`
```js
{
    email: {
        type: String,
        required: true
    },
    ruolo: {
        type: String,
        default: 'autenticato'
    },
    promossoDa: {
        type: mongoose.Types.ObjectId,
        ref: 'Utenti',
        default: mongoose.Types.ObjectId('000000000000000000000000')
    },
    immagine: {
        type: String,
        default: 'https://animati.app/assets/img/logo512.png'
    }
}
``` 

### `Valutazione`
```js
{
    voto: {
        type: Number,
        required: true
    },
    'attività': {
        type: mongoose.ObjectId,
        ref: 'Catalogo',
        required: true
    },
    autore: {
        type: mongoose.ObjectId,
        ref: 'Utenti',
        required: true
    }
}
```

<div class="page-break"></div>

# GitHub Repository and Deployment Info
[...]

<div class="page-break"></div>

# Testing
[...]
